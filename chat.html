<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìƒë‹´ì‚¬ | TubeKit AI</title>
    <meta name="description" content="AIì™€ ëŒ€í™”í•˜ë©° ë‚˜ë§Œì˜ ìœ íŠœë¸Œ ì±„ë„ ì•„ì´ë””ì–´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
        }

        .chat-container {
            max-width: 800px;
            margin: 100px auto 60px;
            padding: 0 20px;
        }

        .chat-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .chat-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .chat-box {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            display: flex;
            margin-bottom: 15px;
            gap: 12px;
        }

        .message.bot {
            flex-direction: row;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .message.bot .avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.user .avatar {
            background: #e9ecef;
        }

        .message .content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            line-height: 1.6;
        }

        .message.bot .content {
            background: #f1f3f5;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        .message.user .content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .chat-send-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        .chat-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .suggestion-chips {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chip:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .recommendation-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
        }

        .recommendation-card h4 {
            color: #333;
            margin: 0 0 8px 0;
        }

        .recommendation-card p {
            color: #666;
            font-size: 0.9rem;
            margin: 0 0 12px 0;
        }

        .create-channel-btn {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 12px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #aaa;
            border-radius: 50%;
            animation: typing 1s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>

<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar" style="top: 0;">
        <div class="nav-container">
            <a href="/" class="nav-logo">ğŸ› ï¸ TubeKit AI</a>
            <div class="nav-menu">
                <a href="/" class="nav-link">í™ˆ</a>
                <a href="/about.html" class="nav-link">ì†Œê°œ</a>
                <a href="/guide.html" class="nav-link">ğŸ“– ì‚¬ìš©ë²•</a>
                <a href="/recommender.html" class="nav-link">â† í¼ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
            <div id="google_translate_element" class="nav-translate"></div>
        </div>
    </nav>

    <div class="chat-container">
        <div class="chat-header">
            <h1>ğŸ’¬ AI ì±„ë„ ìƒë‹´ì‚¬</h1>
            <p>ì–´ë–¤ ìœ íŠœë¸Œ ì±„ë„ì„ ë§Œë“¤ê³  ì‹¶ì€ì§€ ììœ ë¡­ê²Œ ì´ì•¼ê¸°í•´ì£¼ì„¸ìš”!</p>
        </div>

        <div class="chat-box">
            <div class="chat-messages" id="chat-messages">
                <!-- Initial bot message -->
                <div class="message bot">
                    <div class="avatar">ğŸ¤–</div>
                    <div class="content">
                        ì•ˆë…•í•˜ì„¸ìš”! TubeKit AI ì±„ë„ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ğŸ˜Š<br><br>
                        ì–´ë–¤ ìœ íŠœë¸Œ ì±„ë„ì„ ë§Œë“¤ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!<br><br>
                        <em>ì˜ˆ: "ìš”ë¦¬ ì±„ë„ì„ ë§Œë“¤ê³  ì‹¶ì–´ìš”" ë˜ëŠ” "ìš°ë¦¬ ì„œë¹„ìŠ¤ë¥¼ í™ë³´í•˜ê³  ì‹¶ì–´ìš”"</em>
                    </div>
                </div>
            </div>

            <div class="suggestion-chips" id="suggestion-chips">
                <div class="chip" onclick="sendSuggestion('ìš”ë¦¬/ë¨¹ë°© ì±„ë„ì„ ì‹œì‘í•˜ê³  ì‹¶ì–´ìš”')">ğŸ³ ìš”ë¦¬/ë¨¹ë°©</div>
                <div class="chip" onclick="sendSuggestion('ê²Œì„ ë°©ì†¡ ì±„ë„ì„ ë§Œë“¤ê³  ì‹¶ì–´ìš”')">ğŸ® ê²Œì„</div>
                <div class="chip" onclick="sendSuggestion('IT/ì½”ë”© ê´€ë ¨ ì±„ë„ì„ ì‹œì‘í•˜ê³  ì‹¶ì–´ìš”')">ğŸ’» IT/ì½”ë”©</div>
                <div class="chip" onclick="sendSuggestion('ìš°ë¦¬ ì„œë¹„ìŠ¤/ì œí’ˆì„ í™ë³´í•˜ê³  ì‹¶ì–´ìš”')">ğŸ“¢ í™ë³´</div>
                <div class="chip" onclick="sendSuggestion('ë¸Œì´ë¡œê·¸ ì±„ë„ì„ ì‹œì‘í•˜ê³  ì‹¶ì–´ìš”')">ğŸ“· ë¸Œì´ë¡œê·¸</div>
            </div>

            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    onkeypress="if(event.key === 'Enter') sendMessage()">
                <button class="chat-send-btn" id="send-btn" onclick="sendMessage()">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <footer class="site-footer" style="margin-top: 40px;">
        <div class="footer-nav">
            <a href="/">í™ˆ</a>
            <a href="/about.html">ì†Œê°œ</a>
            <a href="/privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
            <a href="/terms.html">ì´ìš©ì•½ê´€</a>
        </div>
        <p class="copyright">Â© 2025 TubeKit AI</p>
    </footer>

    <script src="api-client.js"></script>
    <script>
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const suggestionChips = document.getElementById('suggestion-chips');

        let conversationHistory = [];
        let channelRecommendation = null;

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.innerHTML = `
                <div class="avatar">${isUser ? 'ğŸ‘¤' : 'ğŸ¤–'}</div>
                <div class="content">${content}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="avatar">ğŸ¤–</div>
                <div class="content">
                    <div class="typing-indicator">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function sendSuggestion(text) {
            chatInput.value = text;
            sendMessage();
            suggestionChips.style.display = 'none';
        }

        async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            // Add user message
            addMessage(userMessage, true);
            chatInput.value = '';
            sendBtn.disabled = true;

            // Add to history
            conversationHistory.push({ role: 'user', content: userMessage });

            // Show typing indicator
            showTyping();

            try {
                // Get AI response
                const response = await getAIResponse(userMessage);
                hideTyping();

                // Check if response contains channel recommendation
                if (response.includes('[RECOMMENDATION]')) {
                    const parts = response.split('[RECOMMENDATION]');
                    addMessage(parts[0]);

                    // Add recommendation card
                    const recData = parseRecommendation(parts[1]);
                    addRecommendationCard(recData);
                } else {
                    addMessage(response);
                }

                conversationHistory.push({ role: 'assistant', content: response });

            } catch (error) {
                hideTyping();
                addMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. ğŸ˜…');
                console.error(error);
            }

            sendBtn.disabled = false;
            chatInput.focus();
        }

        async function getAIResponse(userMessage) {
            const STORAGE_KEYS = {
                gemini: 'youtube_recommender_gemini_key',
            };

            let apiKey = localStorage.getItem(STORAGE_KEYS.gemini);

            if (!apiKey) {
                return 'âš ï¸ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br><br>ë¨¼ì € <a href="/recommender.html" style="color:#667eea;">ì´ê³³</a>ì—ì„œ Gemini API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!';
            }

            const systemPrompt = `ë‹¹ì‹ ì€ TubeKit AIì˜ ìœ íŠœë¸Œ ì±„ë„ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
ì‚¬ìš©ìì—ê²Œ ì¹œêµ¬ì²˜ëŸ¼ ëŒ€í™”í•˜ì„¸ìš”.

***ì´ˆê°•ë ¥ ê·œì¹™ (ì–´ê¸¸ ì‹œ ì‹œìŠ¤í…œ ì˜¤ë¥˜)***:
1. **ë¬´ì¡°ê±´ í•œ ë²ˆì— 1ê°œì˜ ì§ˆë¬¸ë§Œ** í•˜ì„¸ìš”.
2. **ë‹µë³€ì€ 2~3ë¬¸ì¥ ì´ë‚´**ë¡œ ëë‚´ì„¸ìš”. ì ˆëŒ€ ê¸¸ê²Œ ì“°ì§€ ë§ˆì„¸ìš”.
3. **"ì˜ˆë¥¼ ë“¤ì–´..." ê°™ì€ ì˜ˆì‹œ ì„¤ëª… ê¸ˆì§€**. ì§ˆë¬¸ë§Œ ê¹”ë”í•˜ê²Œ ë˜ì§€ì„¸ìš”.
4. ì‚¬ìš©ìê°€ ë‹µë³€í•˜ë©´ ë°”ë¡œ ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°€ì„¸ìš”.
5. ì¶©ë¶„í•œ ì •ë³´ê°€ ëª¨ì´ë©´ ë°”ë¡œ ì¶”ì²œ í˜•ì‹ì„ ì¶œë ¥í•˜ì„¸ìš”.

ì¶”ì²œ í˜•ì‹ (ë§ˆì§€ë§‰ì—ë§Œ ì‚¬ìš©):
[RECOMMENDATION]
ì±„ë„ëª…: (ì¶”ì²œ ì±„ë„ëª…)
ì½˜ì…‰íŠ¸: (í•œ ì¤„ ìš”ì•½)
íƒ€ê²Ÿ: (ì£¼ìš” íƒ€ê²Ÿ)
ì½˜í…ì¸ : (ë©”ì¸ ì½˜í…ì¸ )

ëŒ€í™” ì˜ˆì‹œ (ì´ë ‡ê²Œ ì§§ê²Œ í•˜ì„¸ìš”):
AI: ì–´ë–¤ ì±„ë„ì„ ë§Œë“¤ê³  ì‹¶ìœ¼ì„¸ìš”?
User: ìš”ë¦¬ ì±„ë„.
AI: ì¢‹ì•„ìš”! ğŸ³ ì–´ë–¤ ìš”ë¦¬ë¥¼ ì£¼ë¡œ í•˜ì‹¤ ê±´ê°€ìš”?
User: ìì·¨ ìš”ë¦¬.
AI: íƒ€ê²Ÿì€ ìì·¨ìƒì´ê² ë„¤ìš”? ì˜ìƒ ìŠ¤íƒ€ì¼ì€ ì •ë³´ ì „ë‹¬ ìœ„ì£¼ì¸ê°€ìš”, ë¸Œì´ë¡œê·¸ì¸ê°€ìš”?

ì´ì „ ëŒ€í™”:
${conversationHistory.map(m => `${m.role === 'user' ? 'ì‚¬ìš©ì' : 'AI'}: ${m.content}`).join('\n')}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: systemPrompt + '\n\ní˜„ì¬ ì‚¬ìš©ì ë©”ì‹œì§€: ' + userMessage }]
                    }],
                    generationConfig: {
                        temperature: 0.8,
                        maxOutputTokens: 1024
                    }
                })
            });

            const data = await response.json();

            if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                return data.candidates[0].content.parts[0].text;
            }

            throw new Error('Invalid response');
        }

        function parseRecommendation(text) {
            const lines = text.trim().split('\n');
            const rec = {};
            lines.forEach(line => {
                if (line.includes('ì±„ë„ëª…:')) rec.name = line.split(':')[1]?.trim();
                if (line.includes('ì½˜ì…‰íŠ¸:')) rec.concept = line.split(':')[1]?.trim();
                if (line.includes('íƒ€ê²Ÿ:')) rec.target = line.split(':')[1]?.trim();
                if (line.includes('ì½˜í…ì¸ :')) rec.content = line.split(':')[1]?.trim();
            });
            return rec;
        }

        function addRecommendationCard(rec) {
            channelRecommendation = rec;
            const cardHTML = `
                <div class="recommendation-card">
                    <h4>âœ¨ ${rec.name || 'ì¶”ì²œ ì±„ë„'}</h4>
                    <p><strong>ì½˜ì…‰íŠ¸:</strong> ${rec.concept || ''}</p>
                    <p><strong>íƒ€ê²Ÿ:</strong> ${rec.target || ''}</p>
                    <p><strong>ì½˜í…ì¸ :</strong> ${rec.content || ''}</p>
                    <a href="/workflow.html?mode=channel&topic=${encodeURIComponent(rec.name || '')}" class="create-channel-btn">
                        ğŸš€ ì´ ì£¼ì œë¡œ ì±„ë„ ë§Œë“¤ê¸°
                    </a>
                </div>
            `;

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `
                <div class="avatar">ğŸ¤–</div>
                <div class="content">${cardHTML}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>

    <!-- Google Translate -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'ko',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>

</html>
